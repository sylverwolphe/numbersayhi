<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>numbersayhi.fyi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fafafa;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.4;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .tagline {
            color: #666;
            font-size: 14px;
        }

        .nav {
            text-align: center;
            margin: 30px 0;
        }

        .nav-btn {
            padding: 8px 16px;
            background: white;
            color: #333;
            border: 1px solid #ddd;
            cursor: pointer;
            margin: 0 4px;
        }

        .nav-btn.active {
            background: #333;
            color: white;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background: white;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card h3 {
            margin: 0 0 16px 0;
            font-size: 18px;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            font-size: 14px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #333;
        }

        .btn {
            background: #333;
            color: white;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
            margin: 4px 4px 4px 0;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }

        .stat-card {
            background: #f5f5f5;
            padding: 16px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            margin: 16px 0;
        }

        .menu-item {
            background: #f5f5f5;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        .qr-container {
            text-align: center;
            padding: 20px;
            background: #f9f9f9;
            border: 1px solid #ddd;
        }

        .qr-code {
            max-width: 150px;
            margin: 12px auto;
        }

        .feedback-item {
            background: #f9f9f9;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid #333;
            font-size: 14px;
        }

        .rating-buttons {
            display: flex;
            gap: 8px;
            margin: 16px 0;
            flex-wrap: wrap;
        }

        .rating-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        .rating-btn.selected {
            background: #333;
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #eee;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: #333;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 12px 16px;
            font-size: 14px;
            z-index: 1000;
        }
    </style>
</head>
<body>
<!--    <div class="container">
        <div class="header">
            <h1 class="logo">Numbers Say Hi</h1>
            <p class="tagline">Track things in a not-grumpy way</p>
        </div> -->

        <nav class="nav">
            <button class="nav-btn active" onclick="showSection('feedback')">Feedback Forms</button>
            <button class="nav-btn" onclick="showSection('orders')">Menu Orders</button>
            <button class="nav-btn" onclick="showSection('drinks')">Drink Testing</button>
        </nav>

        <!-- Customer Survey Section (shown when ?form=ID is in URL) -->
        <section id="customerSurvey" class="section" style="display: none;">
            <div class="card">
                <h3 id="surveyTitle">Feedback Survey</h3>
                <form id="surveyForm">
                    <div id="surveyQuestions"></div>
                    <button type="button" class="btn" onclick="submitSurvey()">Submit Feedback</button>
                </form>
            </div>
            <div class="card" id="thankYou" style="display: none;">
                <h3>Thank you!</h3>
                <p>Your feedback has been submitted.</p>
            </div>
        </section>

        <!-- Feedback Section -->
        <section id="feedback" class="section active">
            <div class="card">
                <h3>Create Feedback Form</h3>
                <div class="input-group">
                    <label>Form Name</label>
                    <input type="text" id="formName" placeholder="e.g., Service Quality Survey">
                </div>
                <div class="input-group">
                    <label>Questions (one per line)</label>
                    <textarea id="formQuestions" rows="4" placeholder="How was your service today?&#10;Rate our coffee quality (1-5)&#10;Any suggestions?"></textarea>
                </div>
                <button class="btn" onclick="createFeedbackForm()">Create Form & Generate QR Code</button>
            </div>

            <div id="qrDisplay" class="card" style="display: none;">
                <h3>Your Feedback QR Code</h3>
                <div class="qr-container">
                    <img id="qrCode" class="qr-code" alt="QR Code">
                    <p>Share this QR code to collect feedback!</p>
                    <p id="formUrl"></p>
                </div>
            </div>

            <div class="card">
                <h3>Feedback Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalResponses">0</div>
                        <div class="stat-label">Total Responses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayResponses">0</div>
                        <div class="stat-label">Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgRating">0</div>
                        <div class="stat-label">Avg Rating</div>
                    </div>
                </div>
                <div class="feedback-list" id="feedbackList"></div>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="orders" class="section">
            <div class="card">
                <h3>Menu Management</h3>
                <div class="input-group">
                    <label>New Drink Name</label>
                    <input type="text" id="newDrinkName" placeholder="e.g., Lavender Latte">
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <input type="text" id="newDrinkDescription" placeholder="Oat milk, house lavender syrup, double shot">
                </div>
                <button class="btn" onclick="addMenuItem()">Add to Menu</button>
            </div>

            <div class="card">
                <h3>Current Menu</h3>
                <div class="menu-grid" id="menuGrid"></div>
            </div>

            <div class="card" id="archiveSection" style="display: none;">
                <h3>Archived Items</h3>
                <div class="menu-grid" id="archiveGrid"></div>
            </div>

            <div class="card">
                <h3>Order Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalOrders">0</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayOrders">0</div>
                        <div class="stat-label">Today's Orders</div>
                    </div>
                </div>
                <div id="topSellingDrink">
                    <h4>Today's Top Seller: <span id="topDrinkName">-</span></h4>
                </div>
            </div>
        </section>

        <!-- Drink Testing Section -->
        <section id="drinks" class="section">
            <div class="card">
                <h3>Test a New Drink</h3>
                <div class="input-group">
                    <label>Drink Name</label>
                    <input type="text" id="testDrinkName" placeholder="e.g., Cardamom Oat Milk Cortado">
                </div>
                <div class="input-group">
                    <label>Test Date</label>
                    <input type="date" id="testDate" value="">
                </div>
                <div class="input-group">
                    <label>Your Rating</label>
                    <div class="rating-buttons">
                        <button class="rating-btn" onclick="selectRating('love')">😍 Love It</button>
                        <button class="rating-btn" onclick="selectRating('like')">😊 Like It</button>
                        <button class="rating-btn" onclick="selectRating('meh')">😐 Meh</button>
                        <button class="rating-btn" onclick="selectRating('dislike')">😕 Don't Like</button>
                        <button class="rating-btn" onclick="selectRating('hate')">🤢 Hate It</button>
                    </div>
                </div>
                <div class="input-group">
                    <label>Notes (optional)</label>
                    <textarea id="testNotes" rows="3" placeholder="Too sweet, needs more espresso, interesting but not for customers..."></textarea>
                </div>
                <button class="btn" onclick="recordDrinkTest()">Record Test</button>
            </div>

            <div class="card">
                <h3>Testing Stats & Boldness Tracker</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTests">0</div>
                        <div class="stat-label">Drinks Tested</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="likePercentage">0%</div>
                        <div class="stat-label">Like Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="boldnessScore">0%</div>
                        <div class="stat-label">Boldness Score</div>
                    </div>
                </div>
                
                <div style="margin: 2rem 0;">
                    <h4>Boldness Progress (Maximize Dislikes!)</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="boldnessProgress" style="width: 0%"></div>
                    </div>
                    <p><strong>Goal:</strong> Keep testing drinks you might not like to stay bold! 🎯</p>
                </div>

                <div id="recentTests" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </section>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA0NHovIKAxxdCJLXz5leMEgrsTeiIGs_c",
            authDomain: "numbersayhifyi.firebaseapp.com",
            projectId: "numbersayhifyi",
            storageBucket: "numbersayhifyi.firebasestorage.app",
            messagingSenderId: "276303719867",
            appId: "1:276303719867:web:07c3d314bd4f70a6c5289e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Global state
        let currentFormId = null;
        let selectedRating = null;
        let menuItems = [];
        let drinkTests = [];
        let feedbackResponses = [];
        let orders = [];

        // Set today's date
        document.getElementById('testDate').valueAsDate = new Date();

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data when switching sections
            if (sectionName === 'feedback') loadFeedbackStats();
            if (sectionName === 'orders') loadOrderStats();
            if (sectionName === 'drinks') loadDrinkTestStats();
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Feedback Form Functions
        function createFeedbackForm() {
            const formName = document.getElementById('formName').value;
            const questions = document.getElementById('formQuestions').value;
            
            if (!formName || !questions) {
                showNotification('Please fill in form name and questions', 'error');
                return;
            }

            currentFormId = Date.now().toString();
            const formData = {
                id: currentFormId,
                name: formName,
                questions: questions.split('\n'),
                created: new Date(),
                responses: []
            };

            // Save to Firebase
            db.collection('feedbackForms').doc(currentFormId).set(formData)
                .then(() => {
                    // Generate QR Code
                    const formUrl = `${window.location.origin}?form=${currentFormId}`;
                    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(formUrl)}`;
                    
                    document.getElementById('qrCode').src = qrUrl;
                    document.getElementById('formUrl').textContent = formUrl;
                    document.getElementById('qrDisplay').style.display = 'block';
                    
                    showNotification('Feedback form created successfully! 🎉');
                });
        }

        function loadFeedbackStats() {
            db.collection('feedbackResponses').get().then((snapshot) => {
                const responses = [];
                snapshot.forEach(doc => responses.push(doc.data()));
                
                const today = new Date().toDateString();
                const todayResponses = responses.filter(r => new Date(r.timestamp?.toDate?.() || r.timestamp).toDateString() === today);
                
                document.getElementById('totalResponses').textContent = responses.length;
                document.getElementById('todayResponses').textContent = todayResponses.length;
                
                // Calculate average rating (assuming rating questions)
                const ratings = responses.map(r => {
                    const ratingAnswer = r.answers?.find(a => a.includes('rating') || /\d/.test(a));
                    return ratingAnswer ? parseInt(ratingAnswer.match(/\d+/)?.[0]) : null;
                }).filter(r => r !== null);
                
                const avgRating = ratings.length ? (ratings.reduce((a, b) => a + b) / ratings.length).toFixed(1) : 0;
                document.getElementById('avgRating').textContent = avgRating;
                
                // Display recent feedback
                const feedbackList = document.getElementById('feedbackList');
                feedbackList.innerHTML = responses.slice(-5).reverse().map(r => 
                    `<div class="feedback-item">
                        <strong>${new Date(r.timestamp?.toDate?.() || r.timestamp).toLocaleString()}</strong>
                        <div>${r.answers?.join('<br>') || 'No answers'}</div>
                    </div>`
                ).join('');
            });
        }

        // Menu/Orders Functions
        function addMenuItem() {
            const name = document.getElementById('newDrinkName').value;
            const description = document.getElementById('newDrinkDescription').value;
            
            if (!name || !description) {
                showNotification('Please enter drink name and description', 'error');
                return;
            }

            const menuItem = {
                id: Date.now().toString(),
                name: name,
                description: description,
                created: new Date(),
                active: true
            };

            db.collection('menuItems').doc(menuItem.id).set(menuItem)
                .then(() => {
                    menuItems.push(menuItem);
                    renderMenu();
                    document.getElementById('newDrinkName').value = '';
                    document.getElementById('newDrinkDescription').value = '';
                    showNotification(`${name} added to menu!`);
                });
        }

        function renderMenu() {
            const activeItems = menuItems.filter(item => item.active);
            const archivedItems = menuItems.filter(item => !item.active);
            
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = activeItems.map(item => 
                `<div class="menu-item" onclick="recordOrder('${item.id}')">
                    <strong>${item.name}</strong>
                    <div style="font-size: 12px; color: #666; margin-top: 4px;">${item.description}</div>
                    <small onclick="event.stopPropagation(); archiveItem('${item.id}')" style="color: #999; cursor: pointer; display: block; margin-top: 8px;">Archive</small>
                </div>`
            ).join('');

            const archiveGrid = document.getElementById('archiveGrid');
            const archiveSection = document.getElementById('archiveSection');
            
            if (archivedItems.length > 0) {
                archiveSection.style.display = 'block';
                archiveGrid.innerHTML = archivedItems.map(item => 
                    `<div class="menu-item" style="opacity: 0.6;" onclick="unarchiveItem('${item.id}')">
                        <strong>${item.name}</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">${item.description}</div>
                        <small style="color: #999; display: block; margin-top: 8px;">Click to restore</small>
                    </div>`
                ).join('');
            } else {
                archiveSection.style.display = 'none';
            }
        }

        function recordOrder(itemId) {
            const item = menuItems.find(m => m.id === itemId);
            if (!item) return;

            const order = {
                id: Date.now().toString(),
                itemId: itemId,
                itemName: item.name,
                timestamp: new Date()
            };

            db.collection('orders').doc(order.id).set(order)
                .then(() => {
                    orders.push(order);
                    loadOrderStats();
                    showNotification(`Ordered: ${item.name}`);
                });
        }

        function archiveItem(itemId) {
            db.collection('menuItems').doc(itemId).update({ active: false })
                .then(() => {
                    const item = menuItems.find(m => m.id === itemId);
                    if (item) item.active = false;
                    renderMenu();
                    showNotification('Item archived');
                });
        }

        function unarchiveItem(itemId) {
            db.collection('menuItems').doc(itemId).update({ active: true })
                .then(() => {
                    const item = menuItems.find(m => m.id === itemId);
                    if (item) item.active = true;
                    renderMenu();
                    showNotification('Item restored to menu');
                });
        }

        function loadOrderStats() {
            // Load menu items
            db.collection('menuItems').get().then((snapshot) => {
                menuItems = [];
                snapshot.forEach(doc => menuItems.push({id: doc.id, ...doc.data()}));
                renderMenu();
            });

            // Load orders
            db.collection('orders').get().then((snapshot) => {
                orders = [];
                snapshot.forEach(doc => orders.push(doc.data()));
                
                const today = new Date().toDateString();
                const todayOrders = orders.filter(o => new Date(o.timestamp?.toDate?.() || o.timestamp).toDateString() === today);
                
                document.getElementById('totalOrders').textContent = orders.length;
                document.getElementById('todayOrders').textContent = todayOrders.length;
                
                // Find top selling drink today
                const drinkCounts = {};
                todayOrders.forEach(order => {
                    drinkCounts[order.itemName] = (drinkCounts[order.itemName] || 0) + 1;
                });
                
                const topDrink = Object.entries(drinkCounts).sort(([,a], [,b]) => b - a)[0];
                document.getElementById('topDrinkName').textContent = topDrink ? `${topDrink[0]} (${topDrink[1]} orders)` : 'None yet';
            });
        }

        // Drink Testing Functions
        function selectRating(rating) {
            document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedRating = rating;
        }

        function recordDrinkTest() {
            const drinkName = document.getElementById('testDrinkName').value;
            const testDate = document.getElementById('testDate').value;
            const notes = document.getElementById('testNotes').value;
            
            if (!drinkName || !testDate || !selectedRating) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            const test = {
                id: Date.now().toString(),
                drinkName: drinkName,
                date: testDate,
                rating: selectedRating,
                notes: notes,
                timestamp: new Date()
            };

            db.collection('drinkTests').doc(test.id).set(test)
                .then(() => {
                    drinkTests.push(test);
                    loadDrinkTestStats();
                    
                    // Clear form
                    document.getElementById('testDrinkName').value = '';
                    document.getElementById('testNotes').value = '';
                    document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
                    selectedRating = null;
                    
                    showNotification(`Test recorded for ${drinkName}! 🧪`);
                });
        }

        function loadDrinkTestStats() {
            db.collection('drinkTests').get().then((snapshot) => {
                drinkTests = [];
                snapshot.forEach(doc => drinkTests.push(doc.data()));
                
                const totalTests = drinkTests.length;
                const likedTests = drinkTests.filter(t => ['love', 'like'].includes(t.rating)).length;
                const dislikedTests = drinkTests.filter(t => ['meh', 'dislike', 'hate'].includes(t.rating)).length;
                
                const likePercentage = totalTests ? Math.round((likedTests / totalTests) * 100) : 0;
                const boldnessScore = totalTests ? Math.round((dislikedTests / totalTests) * 100) : 0;
                
                document.getElementById('totalTests').textContent = totalTests;
                document.getElementById('likePercentage').textContent = `${likePercentage}%`;
                document.getElementById('boldnessScore').textContent = `${boldnessScore}%`;
                document.getElementById('boldnessProgress').style.width = `${boldnessScore}%`;
                
                // Display recent tests
                const recentTests = document.getElementById('recentTests');
                recentTests.innerHTML = `<h4>Recent Tests:</h4>` + drinkTests.slice(-10).reverse().map(test => 
                    `<div class="feedback-item">
                        <strong>${test.drinkName}</strong> - ${test.date}
                        <div>Rating: ${getRatingEmoji(test.rating)} ${test.rating}</div>
                        ${test.notes ? `<div><em>${test.notes}</em></div>` : ''}
                    </div>`
                ).join('');
            });
        }

        function getRatingEmoji(rating) {
            const emojis = {
                'love': '😍',
                'like': '😊',
                'meh': '😐',
                'dislike': '😕',
                'hate': '🤢'
            };
            return emojis[rating] || '❓';
        }

        // Check for feedback form in URL
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const formId = urlParams.get('form');
            
            if (formId) {
                // Show customer survey interface
                showCustomerSurvey(formId);
            } else {
                // Load initial data for admin view
                loadFeedbackStats();
                loadOrderStats();
                loadDrinkTestStats();
            }
        });

        function showCustomerSurvey(formId) {
            // Hide admin interface
            document.querySelector('.nav').style.display = 'none';
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show customer survey
            document.getElementById('customerSurvey').style.display = 'block';
            
            // Load the form from Firebase
            db.collection('feedbackForms').doc(formId).get().then((doc) => {
                if (doc.exists) {
                    const formData = doc.data();
                    document.getElementById('surveyTitle').textContent = formData.name;
                    
                    const questionsHtml = formData.questions.map((question, index) => 
                        `<div class="input-group">
                            <label>${question}</label>
                            <input type="text" name="question_${index}" placeholder="Your answer...">
                        </div>`
                    ).join('');
                    
                    document.getElementById('surveyQuestions').innerHTML = questionsHtml;
                    
                    // Store form data for submission
                    window.currentForm = { id: formId, ...formData };
                } else {
                    document.getElementById('surveyTitle').textContent = 'Survey not found';
                    document.getElementById('surveyQuestions').innerHTML = '<p>This survey link is invalid or expired.</p>';
                }
            });
        }

        function submitSurvey() {
            const formData = new FormData(document.getElementById('surveyForm'));
            const answers = [];
            
            // Get all answers
            for (let [key, value] of formData.entries()) {
                if (value.trim()) {
                    answers.push(value.trim());
                }
            }
            
            if (answers.length === 0) {
                showNotification('Please answer at least one question', 'error');
                return;
            }
            
            const response = {
                id: Date.now().toString(),
                formId: window.currentForm.id,
                formName: window.currentForm.name,
                answers: answers,
                timestamp: new Date()
            };
            
            // Save response to Firebase
            db.collection('feedbackResponses').doc(response.id).set(response)
                .then(() => {
                    document.getElementById('surveyForm').style.display = 'none';
                    document.getElementById('thankYou').style.display = 'block';
                });
        }
    </script>
</body>
</html>
