<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>numbersayhi.fyi</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: system-ui; margin: 0; padding: 2rem; background: #fafafa; }
    .hidden { display: none; }
    .card { background: white; padding: 1rem; margin: 1rem 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .stat-number { font-size: 2rem; font-weight: bold; color: #2563eb; }
    .form-group { margin: 1rem 0; }
    label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
    input, textarea, select { width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; }
    button { padding: 0.5rem 1rem; border: none; background: #2563eb; color: white; border-radius: 4px; cursor: pointer; }
    button:hover { background: #1d4ed8; }
    .toggle { cursor: pointer; color: #2563eb; text-decoration: underline; }
    .qr-code { margin: 1rem 0; }
  </style>
</head>
<body>
  <h1>numbersayhi.fyi</h1>

  <!-- Auth Section -->
  <div id="authSection">
    <div class="card">
      <h2>Sign In / Sign Up</h2>
      <div class="form-group">
        <label>Email:</label>
        <input type="email" id="emailInput" placeholder="you@example.com">
      </div>
      <div class="form-group">
        <label>Password:</label>
        <input type="password" id="passwordInput" placeholder="••••••••">
      </div>
      <button onclick="signIn()">Sign In</button>
      <button onclick="signUp()">Sign Up</button>
    </div>
  </div>

  <!-- Main App -->
  <div id="appSection" class="hidden">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2>My Projects</h2>
      <button onclick="signOut()">Sign Out</button>
    </div>

    <!-- Create Project -->
    <div class="card">
      <h3>Create New Project</h3>
      <div class="form-group">
        <label>Project Name:</label>
        <input type="text" id="projectName" placeholder="My Awesome Startup">
      </div>
      <button onclick="createProject()">Create Project</button>
    </div>

    <!-- Projects List -->
    <div id="projectsList"></div>
  </div>

  <!-- Project Detail Modal -->
  <div id="projectDetail" class="hidden">
    <div class="card">
      <div style="display: flex; justify-content: space-between;">
        <h3 id="projectTitle">Project Name</h3>
        <button onclick="closeProjectDetail()">×</button>
      </div>
      
      <!-- Create Tool -->
      <div class="card">
        <h4>Add Tracking Tool</h4>
        <div class="form-group">
          <label>Tool Name:</label>
          <input type="text" id="toolName" placeholder="Customer Feedback">
        </div>
        <div class="form-group">
          <label>Type:</label>
          <select id="toolType">
            <option value="feedback">Feedback Form</option>
            <option value="counter">Simple Counter</option>
          </select>
        </div>
        <button onclick="createTool()">Create Tool</button>
      </div>

      <!-- Tools List -->
      <div id="toolsList"></div>
    </div>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA0NHovIKAxxdCJLXz5leMEgrsTeiIGs_c",
  authDomain: "numbersayhifyi.firebaseapp.com",
  projectId: "numbersayhifyi",
  storageBucket: "numbersayhifyi.firebasestorage.app",
  messagingSenderId: "276303719867",
  appId: "1:276303719867:web:07c3d314bd4f70a6c5289e"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// Auth state
auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('authSection').classList.add('hidden');
    document.getElementById('appSection').classList.remove('hidden');
    loadProjects();
  } else {
    document.getElementById('authSection').classList.remove('hidden');
    document.getElementById('appSection').classList.add('hidden');
  }
});

// Auth functions
function signIn() {
  const email = document.getElementById('emailInput').value;
  const password = document.getElementById('passwordInput').value;
  auth.signInWithEmailAndPassword(email, password).catch(console.error);
}

function signUp() {
  const email = document.getElementById('emailInput').value;
  const password = document.getElementById('passwordInput').value;
  auth.createUserWithEmailAndPassword(email, password).catch(console.error);
}

function signOut() {
  auth.signOut();
}

// Projects
function createProject() {
  const name = document.getElementById('projectName').value;
  if (!name.trim()) return;
  
  const ref = db.ref(`users/${auth.currentUser.uid}/projects`).push();
  ref.set({
    name,
    created: Date.now(),
    public: false
  });
  
  document.getElementById('projectName').value = '';
}

function loadProjects() {
  db.ref(`users/${auth.currentUser.uid}/projects`).on('value', snapshot => {
    const projects = snapshot.val() || {};
    const container = document.getElementById('projectsList');
    container.innerHTML = '';
    
    Object.entries(projects).forEach(([id, project]) => {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <h3>${project.name}</h3>
        <label>
          <input type="checkbox" ${project.public ? 'checked' : ''} 
                 onchange="toggleProjectPublic('${id}', this.checked)">
          Public
        </label>
        <button onclick="openProject('${id}', '${project.name}')">View Details</button>
      `;
      container.appendChild(div);
    });
  });
}

function toggleProjectPublic(projectId, isPublic) {
  db.ref(`users/${auth.currentUser.uid}/projects/${projectId}/public`).set(isPublic);
}

// Project Detail
let currentProjectId = null;

function openProject(id, name) {
  currentProjectId = id;
  document.getElementById('projectTitle').textContent = name;
  document.getElementById('projectDetail').classList.remove('hidden');
  loadTools();
}

function closeProjectDetail() {
  document.getElementById('projectDetail').classList.add('hidden');
  currentProjectId = null;
}

// Tools
function createTool() {
  const name = document.getElementById('toolName').value;
  const type = document.getElementById('toolType').value;
  if (!name.trim() || !currentProjectId) return;
  
  const ref = db.ref(`users/${auth.currentUser.uid}/projects/${currentProjectId}/tools`).push();
  ref.set({
    name,
    type,
    created: Date.now(),
    public: false
  });
  
  document.getElementById('toolName').value = '';
}

function loadTools() {
  db.ref(`users/${auth.currentUser.uid}/projects/${currentProjectId}/tools`).on('value', snapshot => {
    const tools = snapshot.val() || {};
    const container = document.getElementById('toolsList');
    container.innerHTML = '';
    
    Object.entries(tools).forEach(([id, tool]) => {
      const div = document.createElement('div');
      div.className = 'card';
      
      let toolContent = '';
      if (tool.type === 'feedback') {
        toolContent = `
          <p><strong>Feedback Form:</strong></p>
          <div class="qr-code" id="qr-${id}"></div>
          <button onclick="copyFeedbackLink('${id}')">Copy Share Link</button>
          <div id="feedback-${id}"></div>
        `;
      } else if (tool.type === 'counter') {
        toolContent = `
          <p><strong>Counter:</strong></p>
          <div class="stat-number" id="counter-${id}">${tool.count || 0}</div>
          <button onclick="incrementCounter('${id}')">+1</button>
        `;
      }
      
      div.innerHTML = `
        <h4>${tool.name}</h4>
        <label>
          <input type="checkbox" ${tool.public ? 'checked' : ''} 
                 onchange="toggleToolPublic('${id}', this.checked)">
          Public
        </label>
        ${toolContent}
      `;
      container.appendChild(div);
      
      if (tool.type === 'feedback') {
        loadFeedbackStats(id);
        generateQR(id);
      }
    });
  });
}

function toggleToolPublic(toolId, isPublic) {
  db.ref(`users/${auth.currentUser.uid}/projects/${currentProjectId}/tools/${toolId}/public`).set(isPublic);
}

// Feedback Tool
function copyFeedbackLink(toolId) {
  const url = `${window.location.origin}#feedback/${auth.currentUser.uid}/${currentProjectId}/${toolId}`;
  navigator.clipboard.writeText(url);
  alert('Feedback link copied!');
}

function loadFeedbackStats(toolId) {
  const ref = db.ref(`users/${auth.currentUser.uid}/projects/${currentProjectId}/tools/${toolId}/responses`);
  ref.on('value', snapshot => {
    const responses = snapshot.val() || {};
    const container = document.getElementById(`feedback-${toolId}`);
    
    const data = Object.values(responses);
    const count = data.length;
    const words = data.flatMap(r => (r.feedback || '').toLowerCase().split(/\s+/));
    const wordCounts = {};
    words.forEach(word => {
      if (word.length > 3) wordCounts[word] = (wordCounts[word] || 0) + 1;
    });
    
    container.innerHTML = `
      <p><strong>Total Responses:</strong> ${count}</p>
      <div>
        <strong>Common Words:</strong>
        ${Object.entries(wordCounts)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10)
          .map(([word, count]) => `<span style="margin: 0.25rem; padding: 0.25rem 0.5rem; background: #f3f4f6; border-radius: 4px;">${word} (${count})</span>`)
          .join('')}
      </div>
    `;
  });
}

function generateQR(toolId) {
  const url = `${window.location.origin}#feedback/${auth.currentUser.uid}/${currentProjectId}/${toolId}`;
  const qrDiv = document.getElementById(`qr-${toolId}`);
  
  // Simple QR generation (you can replace with a library)
  qrDiv.innerHTML = `
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(url)}" 
         alt="QR Code">
  `;
}

// Counter Tool
function incrementCounter(toolId) {
  const ref = db.ref(`users/${auth.currentUser.uid}/projects/${currentProjectId}/tools/${toolId}`);
  ref.transaction(tool => ({
    ...tool,
    count: (tool.count || 0) + 1
  }));
}

// Handle public feedback form
window.addEventListener('hashchange', handlePublicRoutes);
window.addEventListener('load', handlePublicRoutes);

function handlePublicRoutes() {
  const [_, type, uid, projectId, toolId] = window.location.hash.split('/');
  
  if (type === 'feedback') {
    showPublicFeedbackForm(uid, projectId, toolId);
  }
}

function showPublicFeedbackForm(uid, projectId, toolId) {
  document.body.innerHTML = `
    <div style="max-width: 400px; margin: 2rem auto;">
      <h2>Feedback Form</h2>
      <div class="form-group">
        <label>Your feedback:</label>
        <textarea id="publicFeedback" rows="4" placeholder="Tell us what you think..."></textarea>
      </div>
      <button onclick="submitPublicFeedback('${uid}', '${projectId}', '${toolId}')">Submit</button>
      <p style="color: #666; font-size: 0.875rem;">Thank you for your feedback!</p>
    </div>
  `;
}

function submitPublicFeedback(uid, projectId, toolId) {
  const feedback = document.getElementById('publicFeedback').value;
  if (!feedback.trim()) return;
  
  const ref = db.ref(`users/${uid}/projects/${projectId}/tools/${toolId}/responses`).push();
  ref.set({
    feedback,
    timestamp: Date.now()
  });
  
  document.body.innerHTML = `
    <div style="text-align: center; margin-top: 2rem;">
      <h2>Thank you!</h2>
      <p>Your feedback has been recorded.</p>
    </div>
  `;
}
</script>
</body>
</html>
